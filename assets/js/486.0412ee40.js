(window.webpackJsonp=window.webpackJsonp||[]).push([[486],{1715:function(e,t,s){"use strict";s.r(t);var o=s(26),a=Object(o.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"scaling-n8n"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scaling-n8n"}},[e._v("#")]),e._v(" Scaling n8n")]),e._v(" "),s("p",[e._v("With "),s("RouterLink",{attrs:{to:"/reference/changelog.html#n8n-0-108-0"}},[e._v("n8n@0.108.0")]),e._v(" we have released a few important updates to make n8n more scalable and reliable.")],1),e._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#configuring-workers"}},[e._v("Configuring Workers")]),s("ul",[s("li",[s("a",{attrs:{href:"#set-executions-mode"}},[e._v("Set Executions Mode")])]),s("li",[s("a",{attrs:{href:"#start-redis"}},[e._v("Start Redis")])]),s("li",[s("a",{attrs:{href:"#start-workers"}},[e._v("Start workers")])])])]),s("li",[s("a",{attrs:{href:"#considerations-for-running-n8n-with-queues"}},[e._v("Considerations for running n8n with queues")])]),s("li",[s("a",{attrs:{href:"#webhook-processors"}},[e._v("Webhook processors")]),s("ul",[s("li",[s("a",{attrs:{href:"#configure-webhook-url"}},[e._v("Configure webhook URL")])]),s("li",[s("a",{attrs:{href:"#configure-load-balancer"}},[e._v("Configure load balancer")])]),s("li",[s("a",{attrs:{href:"#disable-webhook-processing-in-the-main-process-optional"}},[e._v("Disable webhook processing in the main process (optional)")])])])]),s("li",[s("a",{attrs:{href:"#avoiding-downtime"}},[e._v("Avoiding downtime")])])])]),s("p"),e._v(" "),s("h2",{attrs:{id:"configuring-workers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuring-workers"}},[e._v("#")]),e._v(" Configuring Workers")]),e._v(" "),s("p",[e._v("New configurations and settings have been added to n8n to run it using queues. To run n8n with queues, you will need to have a "),s("a",{attrs:{href:"https://redis.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis"),s("OutboundLink")],1),e._v(" service available. Redis is mandatory as it acts as the message broker.")]),e._v(" "),s("h3",{attrs:{id:"set-executions-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set-executions-mode"}},[e._v("#")]),e._v(" Set Executions Mode")]),e._v(" "),s("p",[e._v("Set the "),s("RouterLink",{attrs:{to:"/reference/glossary.html#environment-variables"}},[e._v("environment variable")]),e._v(" "),s("code",[e._v("EXECUTIONS_MODE")]),e._v(" to "),s("code",[e._v("queue")]),e._v(" using the following command.")],1),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("EXECUTIONS_MODE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("queue\n")])])]),s("p",[e._v("Alternatively, you can set "),s("code",[e._v("executions.mode")]),e._v(" to "),s("code",[e._v("queue")]),e._v(" in the "),s("RouterLink",{attrs:{to:"/reference/configuration.html#configuration-via-file"}},[e._v("configuration file")]),e._v(".")],1),e._v(" "),s("h3",{attrs:{id:"start-redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#start-redis"}},[e._v("#")]),e._v(" Start Redis")]),e._v(" "),s("p",[e._v("You can run Redis in a Docker container following the instructions mentioned below.")]),e._v(" "),s("ol",[s("li",[e._v("Run the following command to start a Redis instance.")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("docker run --name some-redis -p "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("6379")]),e._v(":6379  -d redis\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("By default, Redis runs on "),s("code",[e._v("localhost")]),e._v(" on port "),s("code",[e._v("6379")]),e._v(" with no password. Based on your configuration, set the following variables in the configuration file.\n"),s("ul",[s("li",[s("code",[e._v("queue.bull.redis.host")])]),e._v(" "),s("li",[s("code",[e._v("queue.bull.redis.port")]),e._v(": The default port is "),s("code",[e._v("6379")]),e._v(". If Redis is running on a different port, configure the value.")]),e._v(" "),s("li",[e._v("Optional configurations\n"),s("ul",[s("li",[s("code",[e._v("queue.bull.redis.password")]),e._v(": By default, Redis doesnâ€™t require a password. However, if youâ€™re using a password to access Redis, configure the variable.")]),e._v(" "),s("li",[s("code",[e._v("queue.bull.redis.db")]),e._v(": The default value is "),s("code",[e._v("0")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("queue.bull.redis.timeoutThreshold")]),e._v(": Tells n8n how long it should wait if Redis is unavailable before exiting. The default value is "),s("code",[e._v("10000ms")]),e._v(".")]),e._v(" "),s("li",[s("code",[e._v("queue.bull.queueRecoveryInterval")]),e._v(": Adds an active watchdog to n8n that checks Redis for finished executions. This is used to recover when n8nâ€™s main process loses connection temporarily to Redis and is unable to get notified about finished jobs. The default value is "),s("code",[e._v("60")]),e._v(" seconds.")])])])])])]),e._v(" "),s("p",[e._v("Alternatively, you can set the following environment variables to configure Redis.")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("QUEUE_BULL_REDIS_HOST")])]),e._v(" "),s("li",[s("code",[e._v("QUEUE_BULL_REDIS_PORT")])]),e._v(" "),s("li",[s("code",[e._v("QUEUE_BULL_REDIS_PASSWORD")])]),e._v(" "),s("li",[s("code",[e._v("QUEUE_BULL_REDIS_DB")])]),e._v(" "),s("li",[s("code",[e._v("QUEUE_BULL_REDIS_TIMEOUT_THRESHOLD")])]),e._v(" "),s("li",[s("code",[e._v("QUEUE_RECOVERY_INTERVAL")])])]),e._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[e._v("The following command will run n8n and automatically connect to your Redis instance.")])]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" run start\n")])])]),s("h3",{attrs:{id:"start-workers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#start-workers"}},[e._v("#")]),e._v(" Start workers")]),e._v(" "),s("p",[e._v("You will need to start worker processes to allow n8n to execute workflows. To start worker processes, run the following command from the root directory.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("./packages/cli/bin/n8n worker\n")])])]),s("p",[e._v("You can start multiple worker processes. They can run anywhere (in a different container or a different machine) as long as they have access to the Redis instance and the main database.")]),e._v(" "),s("h2",{attrs:{id:"considerations-for-running-n8n-with-queues"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#considerations-for-running-n8n-with-queues"}},[e._v("#")]),e._v(" Considerations for running n8n with queues")]),e._v(" "),s("p",[e._v("When running n8n with queues, all the production workflow executions get processed by worker processes. This means that even the webhook calls will be proxied to worker processes. This might add some overhead and extra latency. However, the manual workflow executions still use the main process.")]),e._v(" "),s("p",[e._v("Redis is used as the queue broker, and the database is used to persist data. Hence, access to both is required. Running a distributed system like this over SQLite is not recommended.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Migrate data")]),e._v(" "),s("p",[e._v("If you want to migrate data from one database to another, you can use the Export and Import commands. Refer to the "),s("RouterLink",{attrs:{to:"/reference/start-workflows-via-cli.html#export-workflows-and-credentials"}},[e._v("CLI commands for n8n")]),e._v(" documentation to learn how to use these commands.")],1)]),e._v(" "),s("h2",{attrs:{id:"webhook-processors"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webhook-processors"}},[e._v("#")]),e._v(" Webhook processors")]),e._v(" "),s("p",[e._v("Webhook processors are another layer of scaling in n8n. This is an optional configuration.")]),e._v(" "),s("p",[e._v("Webhook processes also rely on Redis. Follow the steps mentioned above to "),s("a",{attrs:{href:"#configuring-workers"}},[e._v("configure the workers")]),e._v(".")]),e._v(" "),s("p",[e._v("The worker process will listen to requests on the same port (default: "),s("code",[e._v("5678")]),e._v("). Run these worker processes in containers or separate machines, and have a load balancing system to route requests accordingly.")]),e._v(" "),s("p",[e._v("This method allows n8n to process a huge number of parallel requests. All you have to do is add more webhook processes and workers accordingly, as long as the database and Redis are provisioned correctly for the load.")]),e._v(" "),s("p",[e._v("We do not recommend adding the main process to the load balancer pool. If the main process gets added to the pool, it will receive requests and possibly heavy load. This will result in degraded performance for editing, viewing, and interacting with n8n UI.")]),e._v(" "),s("h3",{attrs:{id:"configure-webhook-url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-webhook-url"}},[e._v("#")]),e._v(" Configure webhook URL")]),e._v(" "),s("p",[e._v("You can set up the webhook URL using the "),s("code",[e._v("WEBHOOK_URL")]),e._v(" environment variable.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WEBHOOK_URL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https://your-webhook-url.com\n")])])]),s("h3",{attrs:{id:"configure-load-balancer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configure-load-balancer"}},[e._v("#")]),e._v(" Configure load balancer")]),e._v(" "),s("p",[e._v("When using multiple webhook processes, you will need a load balancer to route requests. If you are using the same domain name for your n8n instance and the webhooks, you can set up your load balancer to route requests as follow:")]),e._v(" "),s("ul",[s("li",[e._v("Redirect any requests that matches "),s("code",[e._v("/webhook/*")]),e._v(" to webhook servers pool")]),e._v(" "),s("li",[e._v("All the other paths (the n8n internal API, the static files for the editor, etc.) should be routed to the main process")])]),e._v(" "),s("p",[s("strong",[e._v("Note:")]),e._v(" Manual workflow executions still occur on the main process and the default URL for these is "),s("code",[e._v("/webhook-test/*")]),e._v(". Make sure that these URLs route to your main process.")]),e._v(" "),s("p",[e._v("These paths can be changed in the settings via "),s("code",[e._v("endpoints.webhook")]),e._v(" or via the "),s("code",[e._v("N8N_ENDPOINT_WEBHOOK")]),e._v(" environment variable. If you change these, update your load balancer accordingly.")]),e._v(" "),s("h3",{attrs:{id:"disable-webhook-processing-in-the-main-process-optional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#disable-webhook-processing-in-the-main-process-optional"}},[e._v("#")]),e._v(" Disable webhook processing in the main process (optional)")]),e._v(" "),s("p",[e._v("Set "),s("code",[e._v("endpoints.disableProductionWebhooksOnMainProcess")]),e._v(" to "),s("code",[e._v("true")]),e._v(" so that n8n does not process webhook requests on the main process.")]),e._v(" "),s("p",[e._v("Alternatively, you can use the following command.")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("N8N_DISABLE_PRODUCTION_MAIN_PROCESS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true\n")])])]),s("p",[e._v("When disabling the webhook process in the main process, make sure that the main process is running and is not added to the load balancer's webhook pool.")]),e._v(" "),s("h2",{attrs:{id:"avoiding-downtime"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#avoiding-downtime"}},[e._v("#")]),e._v(" Avoiding downtime")]),e._v(" "),s("p",[e._v("When it comes to startup and shutdown, n8n will stop all currently executing workflows, disconnect from sources, and deregister webhooks that might have got registered with third-party services. All this happens inside the main process.")]),e._v(" "),s("p",[e._v("A new configuration got added to n8n that allows it to skip deregistering of webhooks during the shutdown. Whenever n8n starts back, this configuration will check for existing webhooks. If a webhook exists, it will not get registered again.")]),e._v(" "),s("p",[e._v("Trigger nodes that do not use HTTP requests will still suffer marginal downtime during the update process.")]),e._v(" "),s("p",[e._v("The setting that controls this behavior is "),s("code",[e._v("endpoint.skipWebhoooksDeregistrationOnShutdown")]),e._v(". It defaults to "),s("code",[e._v("false")]),e._v(" and can be set to "),s("code",[e._v("true")]),e._v(".")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("N8N_SKIP_WEBHOOK_DEREGISTRATION_SHUTDOWN")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("true\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("ðŸ’¡ Keep in mind")]),e._v(" "),s("p",[e._v("Do not use this procedure for blue/green deployments, where you have two n8n instances running simultaneously but only one is receiving active traffic. If you run two or more main processes simultaneously, the currently active instance gets notified of activation and deactivation of workflows. This can potentially cause duplication of work or even skipping workflows entirely.")])])])}),[],!1,null,null,null);t.default=a.exports}}]);